VIX - SP100 relation
VIX mean chart
VIX tango
VIX-VIX put strategy
VIX,XIV,VXX,UVXX
NDX-gold,oil,VIX, relation
*****
cor(GSPC[,4],VIX[,4])#-65%
cor(GSPC[5:length(GSPC[,4]),4],HSI[,4])#64%
cor(GSPC[,4],FTSE[70:length(FTSE[,4]),4])#84%
summary(NDX["2015"][,4])# TQQQ call short when NDX>4550 and SQQQ call short when NDX<4300
summary(VIX["2015"][,4])# VIX and GSPC has -65% relation and 1st Q to Match 4th quartile, NDX>4500::VIX<18 and NDX<4300::VIX>30
test$Return<-ROC(GSPC[,4])
test$ChD<-ifelse(test[,2]>0,1,0)
for(i in 1:length(test[,1])){test$S6[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] && test[i-4,1]>test[i-5,1] && test[i-5,1]>test[i-6,1] ,1,0)}
for(i in 1:length(test[,1])){test$S7[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] && test[i-4,1]>test[i-5,1] && test[i-5,1]>test[i-6,1] && test[i-6,1]>test[i-7,1] ,1,0)}
#7th down probablity 0.3%
for(i in 1:length(test[,1])){test$S8[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] && test[i-4,1]>test[i-5,1] && test[i-5,1]>test[i-6,1] && test[i-6,1]>test[i-7,1] && test[i-7,1]>test[i-8,1] ,1,0)}
for(i in 1:length(test[,1])){test$S5[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] && test[i-4,1]>test[i-5,1] ,1,0)}
for(i in 1:length(test[,1])){test$S4[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] ,1,0)}
for(i in 1:length(test[,1])){test$S3[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] ,1,0)}
for(i in 1:length(test[,1])){test$S2[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] ,1,0)}
for(i in 1:length(test[,1])){test$S6[i]<-ifelse(test[i,1]>test[i-1,1] && test[i-1,1]>test[i-2,1] && test[i-2,1]>test[i-3,1] && test[i-3,1]>test[i-4,1] && test[i-4,1]>test[i-5,1] && test[i-5,1]>test[i-6,1] ,1,0)}

for(i in 1:length(test[,1])){test$SD2[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1],1,0)}
for(i in 1:length(test[,1])){test$SD3[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1],1,0)}
for(i in 1:length(test[,1])){test$SD4[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1] && test[i-3,1]<test[i-4,1],1,0)}
for(i in 1:length(test[,1])){test$SD5[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1] && test[i-3,1]<test[i-4,1] && test[i-4,1]<test[i-5,1],1,0)}
for(i in 1:length(test[,1])){test$SD6[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1] && test[i-3,1]<test[i-4,1] && test[i-4,1]<test[i-5,1] && test[i-5,1]<test[i-6,1],1,0)}
for(i in 1:length(test[,1])){test$SD7[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1] && test[i-3,1]<test[i-4,1] && test[i-4,1]<test[i-5,1] && test[i-5,1]<test[i-6,1] && test[i-6,1]<test[i-7,1],1,0)}
# 6th day down probablity 0.5% and 7th day down probablity 0.2%
for(i in 1:length(test[,1])){test$SD8[i]<-ifelse(test[i,1]<test[i-1,1] && test[i-1,1]<test[i-2,1] && test[i-2,1]<test[i-3,1] && test[i-3,1]<test[i-4,1] && test[i-4,1]<test[i-5,1] && test[i-5,1]<test[i-6,1] && test[i-6,1]<test[i-7,1] && test[i-7,1]<test[i-8,1] ,1,0)}

for(i in 1:length(test[,1])){test$D3[i]<-ifelse(test[i,2]<0 && test[i-1,2]<0 && test[i-2,2]<0,1,0)}
for(i in 1:length(test[,1])){test$D4[i]<-ifelse(test[i,2]<0 && test[i-1,2]<0 && test[i-2,2]<0 && test[i-3,2]<0,1,0)}
for(i in 1:length(test[,1])){test$D5[i]<-ifelse(test[i,2]<0 && test[i-1,2]<0 && test[i-2,2]<0 && test[i-3,2]<0 && test[i-4,2]<0,1,0)}
for(i in 1:length(test[,1])){test$D6[i]<-ifelse(test[i,2]<0 && test[i-1,2]<0 && test[i-2,2]<0 && test[i-3,2]<0 && test[i-4,2]<0 && test[i-5,2]<0,1,0)}
for(i in 1:length(test[,1])){test$D7[i]<-ifelse(test[i,2]<0 && test[i-1,2]<0 && test[i-2,2]<0 && test[i-3,2]<0 && test[i-4,2]<0 && test[i-5,2]<0 && test[i-6,2]<0,1,0)}

for(i in 1:length(test[,1])){test$U5[i]<-ifelse(test[i,2]>0 && test[i-1,2]>0 && test[i-2,2]>0 && test[i-3,2]>0 && test[i-4,2]>0,1,0)}
## 3.5% probablity of 4 consicutive negative days and 3% probablity of 5 consicutive positive days. positive consicutive days have higher probablity
for(i in 1:length(test[,1])){test$JD[i]<-ifelse(test[i,2]<(-0.01),1,0)}#(4% probablity of 2.5% down,17.5% probablity of 1% jump down)
for(i in 1:length(test[,1])){test$JU[i]<-ifelse(test[i,2]>0.015,1,0)}#4% probablity of 2.2% up in a day,8.5% probablity for 1.5% up 
for(i in 1:length(test[,1])){test$JUu1[i]<-ifelse(test$JU[i]==1 && test[i+1,3]==1 ,1,0)}#jump up and positive next day (2.2% jump up and next day up 2%) ((2.2% jump up and next 2 days up 1%)
for(i in 1:length(test[,1])){test$JUu2[i]<-ifelse(test$JU[i]==1 && test[i+1,3]==1 && test[i+2,3]==1 ,1,0)}#(8% jump 1.5%,4% continuing next day and 2% next 2 days)
for(i in 1:length(test[,1])){test$JDd1[i]<-ifelse(test$JD[i]==1 && test[i+1,3]==0 ,1,0)}
for(i in 1:length(test[,1])){test$JDd2[i]<-ifelse(test$JD[i]==1 && test[i+1,3]==0 && test[i+2,3]==0,1,0)}(1% jump down 17.5% probablity,2.8% to be down for next two days)

test$Q3<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.90)#0.75 rolling quantile, 0.90 decile
test$QH<-ifelse(GSPC[,4]>test$Q3,1,0)#35% cases
for(i in 1:length(test[,1])){test$JU[i]<-ifelse(test[i,2]>(0.0075) && test$QH[i]==1,1,0)}# 10%
for(i in 1:length(test[,1])){test$JU[i]<-ifelse(test[i,2]>(0.0075) && test$QH[i]==1 && test[i+1,3]==1,1,0)}# 1.5% up and next day up at top quantile in 1.5%, 3% for 1% up and 4.5% for 0.75% up
for(i in 1:length(test[,1])){test$JU[i]<-ifelse(test[i,2]>(0.0075) && test$QH[i]==1 && test[i+1,3]==1 && test[i+2,3]==1,1,0)}# 0.5% up and next 2 days up at top quantile in 1.5%, 1.3% for 1% up and 2% for 0.75% up
#H:Index at top decile if jumps 0.75 up and continues up for  two  next days has 1.5% probablity 
test$Q1<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.10)
test$QL<-ifelse(GSPC[,4]<test$Q1,1,0)
for(i in 1:length(test[,1])){test$JD[i]<-ifelse(test[i,2]<(-0.01) && test$QL[i]==1 && test[i+1,3]==0 && test[i+2,3]==0,1,0)}#2% 
for(i in 1:length(test[,1])){test$JD[i]<-ifelse(test[i,2]<(-0.01) && test$QL[i]==1 && test[i+1,3]==0 && test[i+2,3]==0,1,0)}#1% 

cor(SI[,2],SI[,5])# OEX-GSPC 0.8940295 , SP100-SP500, #SPY etf SPX index of SP100
#NDX needed for SQQQ,TQQQ. NDX has low correlation with other index.

*****
#H::0.6% jump down and if down for next day (J,D) then buy TQQQ and further buy if (J,D,D,D) on next day as probablity of 99% to down ( J,D,D,D,D)
#H:: 0.75% jump up and if up for next day (J,U) then buy SQQQ. Buy further next day after (J,U,U) and down probablity 99% after (J,U,U,U,D)
#H:: after continous 5 down days up at sixth or seventh day. >> buy TQQQ after 2nd (D,D) on 3rd day if further D then buy again
#H:: After continous 6 up days , down at seventh day.>> buy SQQQ after 3rdd (U,U,U) on 4th day if further U then buy again
#H:Index at top decile if jumps 0.3 up and continues up for  next day ( J,U) then buy SQQQ and buy further next day uptrend if (J,U,U) as (J,U,U,U,D) has 99% probablity 
#H:Index at bottom decaile, jumps down 6% and continues down for next day then (J,D) then buy TQQQ next day. (J,D,D,U) has 99% probablity.
1. Market Open up/down{premarket index,NQ future up/down,Asian Market reaction}
2. Market close is not dependent to 1
3. Market close { model,economic event on that day,news}
PROVING PT.2***
getSymbols("^GSPC")
GSPC$chOPC<-ifelse((GSPC[,1]-lag(GSPC[,4],1))>0,1,0)#OPEN>prev CLOSE==chOPC
GSPC$chCO<-ifelse((GSPC[,4]-GSPC[,1])>0,1,0)#CLOSE-OPEN>0==chCO
GSPC$chCPC<-ifelse((GSPC[,4]-lag(GSPC[,4],1))>0,1,0)#CLOSE>prev CLOSE==chCPC
SI<-GSPC$chOPC
SI$CO<-GSPC$chCO
SI$CPC<-GSPC$chCPC
DATA***
library("quantmod", lib.loc="~/R/win-library/3.2")
getSymbols("^NDX")
getSymbols("^OEX")
getSymbols("^RUI")
getSymbols("^GSPC")
getSymbols("^IXIC")
getSymbols("^SML")
getSymbols("^RUA")
getSymbols("SPY")
getSymbols("^FTSE")
getSymbols("^FCHI")
getSymbols("^GDAXI")
getSymbols("^HSI")
getSymbols("^N225")
getSymbols("^NSEI")
getSymbols("^VIX")
getSymbols("^VXN")
getSymbols("VXX")
getSymbols("XIV")
getSymbols("UVXY")
getSymbols("^VVIX") 
getSymbols("^OVX")
getSymbols("OIL")
getSymbols("USO")
getSymbols("^GVZ")
getSymbols("GLD")
getSymbols("GDX") 
getSymbols("UGLD")
getSymbols("DGLD")
getSymbols("^TYX")
getSymbols("TLT")#TLT and SST and PRTBX for long term
getSymbols("SST")
getSymbols("PRTBX")
getSymbols("XLE")
getSymbols("XLF")
getSymbols("XLK")
getSymbols("XBI")
getSymbols("XLP")
getSymbols("XLV")
getSymbols("XLU")
getSymbols("XLB")
getSymbols("XLY")
getSymbols("XME")
getSymbols("XLI")
getSymbols("SQQQ")
getSymbols("TQQQ")
getSymbols("FXI")
getSymbols("FWZ")
getSymbols("JPY=X")
getSymbols("EUR=X")
getSymbols("CNY=X")
getSymbols("CAD=X")
getSymbols("GBP=X")
getSymbols("aapl")
getSymbols("msft")
getSymbols("xom")
getSymbols("ge")
getSymbols("jnj")
getSymbols("wfc")
getSymbols("amzn")
getSymbols("BRK")
getSymbols("jpm")
getSymbols("fb")
nonfarm <- Quandl('FRED/PAYEMS', type = 'xts',start_date = '2007-01-03', end_date = '2015-12-10')
iniclaim <- Quandl('FRED/ICNSA', type = 'xts',start_date = '2007-01-03', end_date = '2015-12-10')
totalconspend <- Quandl('FRED/TTLCON', type = 'xts',start_date = '2007-01-03', end_date = '2015-12-10')
ismprice <- Quandl('FRED/NAPMPRI', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
ismpemp <- Quandl('FRED/NAPMEI', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
realest <- Quandl('GOOG/SHE_399241', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
insunemp <- Quandl('FRED/IURNSA', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
ccinsunemp <- Quandl('FRED/CCNSA', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
rateinsunemp <- Quandl('FRED/IURSA', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
phlxhsi <- Quandl('YAHOO/INDEX_HGX', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
cboeTpc<- Quandl('CBOE/TOTAL_PC', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
cboeEpc<- Quandl('CBOE/EQUITY_PC', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
cboeVpc<- Quandl('CBOE/VIX_PC', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
cboeSpc<- Quandl('CBOE/SPX_PC', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
cboeEEMpc<- Quandl('CBOE/VXEEM', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
equnc<- Quandl('FRED/WLEMUINDXD', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')#equity market related uncertainty
polunc<- Quandl('FRED/USEPUINDXD', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')#equity market related uncertainty#policy uncertainty
unc10yr<- Quandl('FRED/DGS10', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')#10 years uncertainty
unc3m<- Quandl('FRED/DTB3', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')#3m uncertainty
stresseq<- Quandl('FRED/EQMRKTSD678FRBCLE', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')#Cleveland Financial Stress Index: Equity Markets
fsi<- Quandl('FRED/CFSI', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
motorsls<- Quandl('OICA/SALES_TOT_UNITEDSTATESOFAMERICA', type = 'xts', start_date = '2007-01-03', end_date = '2015-12-10')
CLEANING***
#GSPC$OPC<-ifelse((GSPC[,1]-lag(GSPC[,4],1))>0,1,0)#OPEN>prev CLOSE==chOPC
GSPC$CO<-ifelse((GSPC[,4]-GSPC[,1])>0,1,0)#CLOSE-OPEN>0==chCO
#GSPC$chCPC<-ifelse((GSPC[,4]-lag(GSPC[,4],1))>0,1,0)#CLOSE>prev CLOSE==chCPC
SI<-GSPC$CO
#SI$CO<-GSPC$chCO
#SI$CPC<-GSPC$chCPC
cor(SI$CPC,SI$OPC)#correlation of OPC and CPC is 33%
SI$GSPC<-ifelse(ROC(GSPC[,4])>0,1,0)
SI$CH<-ifelse(SI$CO*SI$GSPC==1,1,0)
SI$Ret<-ROC(GSPC[,4])

for(i in 1:length(SI[,1])){SI$U4[i]<-ifelse(SI$CH[i]==1 && SI$CH[i-1]==1 && SI$CH[i-2]==1 && SI$CH[i-3]==1,1,0)}# (1,2,3,4,5,6,7==0.6%;1,2,3,4,5,6==1.2%;1,2,3,4,5==3.1%;1,2,3,4==7.71)#3 rd up 15.5% and 4th up probablity 6.5% next day 3%. After 3rd day buy SQQQ

for(i in 1:length(SI[,1])){SI$D3[i]<-ifelse(SI$CH[i]==0 && SI$CH[i-1]==0 && SI$CH[i-2]==0,1,0)}# buy TQQQ after 2 nd day with probablity 27% and 3rd day repeated down of 10% probablity, next day again down probablity of 4%. if next day down again then further holding

for(i in 1:length(SI[,1])){SI$JD[i]<-ifelse(SI$Ret[i]<(-0.006),1,0)}#(4% probablity of 2.5% down,17.5% probablity of 1% jump down)
for(i in 1:length(SI[,1])){SI$JDd2[i]<-ifelse(SI$JD[i]==1 && SI$CH[i+1]==0 && SI$CH[i+2]==0,1,0)}#10%
for(i in 1:length(SI[,1])){SI$JU[i]<-ifelse(SI$Ret[i]>0.0075,1,0)}#4% probablity of 2.2% up in a day,8.5% probablity for 1.5% up
for(i in 1:length(SI[,1])){SI$JUu2[i]<-ifelse(SI$JU[i]==1 && SI$CH[i+1]==1 && SI$CH[i+2]==1 ,1,0)}#(25% probablity of  0.75% jump ,12% continuing next day and 5.5% 2 days) 

SI$Q3<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.90,na.rm=TRUE)#0.75 rolling quantile, 0.90 decile
SI$QH<-ifelse(GSPC[,4]>SI$Q3,1,0)#35% cases
for(i in 1:length(SI[,1])){SI$QJU[i]<-ifelse(SI$Ret[i]>0.003 && SI$QH[i]==1,1,0)}# 19%
for(i in 1:length(SI[,1])){SI$QJUu2[i]<-ifelse(SI$QJU[i]==1 && SI$CH[i+1]==1 && SI$CH[i+2]==1,1,0)}# 1.5% up and next day up at top quantile in 1.5%, 3% for 1% up and 4.5% for 0.75% up

SI$Q1<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.10,na.rm=TRUE)
SI$QL<-ifelse(GSPC[,4]<SI$Q1,1,0)
for(i in 1:length(SI[,1])){SI$QJD[i]<-ifelse(SI$Ret[i]<(-0.002) && SI$QL[i]==1,1,0)}#6% 
for(i in 1:length(SI[,1])){SI$QJDd2[i]<-ifelse(SI$QJD[i]==1 && SI$CH[i+1]==0 && SI$CH[i+2]==0,1,0)}#2% 

SI$GSPC<-ifelse(ROC(GSPC[,4])>0,1,0)
SI$NDX<-ifelse(ROC(NDX[,4])>0,1,0)
SI$OEX<-ifelse(ROC(OEX[,4])>0,1,0)
SI$FTSE<-ifelse(ROC(FTSE[,4])>0,1,0)
SI$HSI<-ifelse(ROC(HSI[,4])>0,1,0)
SI$VIX<-ifelse(ROC(VIX[,4])>0,1,0)
SI$OIL<-ifelse(ROC(OIL[,4])>0,1,0)
SI$TYX<-ifelse(ROC (TYX[,4])>0,1,0)
SI$TLT<-ifelse(ROC (TLT[,4])>0,1,0)
SI$XLE<-ifelse(ROC(XLE[,4])>0,1,0)
SI$XLF<-ifelse(ROC(XLF[,4])>0,1,0)
SI$XLK<-ifelse(ROC(XLK[,4])>0,1,0)
SI$XLP<-ifelse(ROC(XLP[,4])>0,1,0)
SI$XLV<-ifelse(ROC(XLV[,4])>0,1,0)
SI$XLB<-ifelse(ROC(XLB[,4])>0,1,0)
SI$XLY<-ifelse(ROC(XLY[,4])>0,1,0)
SI$XLI<-ifelse(ROC(XLI[,4])>0,1,0)
SI$AAPL<-ifelse(ROC(AAPL[,4])>0,1,0)
SI$MSFT<-ifelse(ROC(MSFT[,4])>0,1,0)
SI$XOM<-ifelse(ROC(XOM[,4])>0,1,0)
SI$GE<-ifelse(ROC(GE[,4])>0,1,0)
SI$WFC<-ifelse(ROC(JNJ[,4])>0,1,0)
SI$AMZN<-ifelse(ROC(AMZN[,4])>0,1,0)
SI$BRK<-ifelse(ROC(BRK[,4])>0,1,0)
SI$JPM<-ifelse(ROC(JPM[,4])>0,1,0)
SI$FB<-ifelse(ROC(FB[,4])>0,1,0)

EI<-SI$CH
EI$fsi<-ifelse(fsi[,1]-lag(fsi[,1])>0,1,0)
EI$stresseq<-ifelse(stresseq[,1]-lag(stresseq[,1])>0,1,0)
EI$unc3m<-ifelse(unc3m[,1]-lag(unc3m[,1])>0,1,0)
EI$unc10yr<-ifelse(unc10yr[,1]-lag(unc10yr[,1])>0,1,0)
EI$polunc<-ifelse(polunc[,1]-lag(polunc[,1])>0,1,0)
EI$cboeEEMpc<-ifelse(cboeEEMpc[,1]-lag(cboeEEMpc[,1])>0,1,0)
EI$cboeSpc<-ifelse(cboeSpc[,1]-lag(cboeSpc[,1])>0,1,0)
EI$nonfarm<-ifelse(nonfarm[,1]-lag(nonfarm[,1])>0,1,0)
EI$iniclaim<-ifelse(iniclaim[,1]-lag(iniclaim [,1])>0,1,0)
EI$totalconspend<-ifelse(totalconspend[,1]-lag(totalconspend[,1])>0,1,0)
EI$ismprice<-ifelse(ismprice[,1]-lag(ismprice[,1])>0,1,0)
EI$ismpemp<-ifelse(ismpemp[,1]-lag(ismpemp[,1])>0,1,0)
EI$realest<-ifelse(realest[,1]-lag(realest[,1])>0,1,0)
EI$insunemp<-ifelse(insunemp[,1]-lag(insunemp[,1])>0,1,0)
EI$ccinsunemp<-ifelse(ccinsunemp[,1]-lag(ccinsunemp[,1])>0,1,0)
EI$rateinsunemp<-ifelse(rateinsunemp[,1]-lag(rateinsunemp[,1])>0,1,0)
EI$phlxhsi<-ifelse(phlxhsi[,1]-lag(phlxhsi[,1])>0,1,0)
EI$cboeTpc<-ifelse(cboeTpc[,1]-lag(cboeTpc[,1])>0,1,0)
EI$cboeEpc<-ifelse(cboeEpc[,1]-lag(cboeEpc[,1])>0,1,0)
EI$cboeVpc<-ifelse(cboeVpc[,1]-lag(cboeVpc[,1])>0,1,0)
**
EI$fsi<-ifelse(fsi[,1]-lag(fsi[,1])>0,1,0)
EI$stresseq<-ifelse(stresseq[,1]-lag(stresseq[,1])>0,1,0)
EI$unc3m<-ifelse(unc3m[,1]-lag(unc3m[,1])>0,1,0)
EI$unc10yr<-ifelse(unc10yr[,1]-lag(unc10yr[,1])>0,1,0)
EI$polunc<-ifelse(polunc[,1]-lag(polunc[,1])>0,1,0)
EI$phlxhsi<-ifelse(phlxhsi[,1]-lag(phlxhsi[,1])>0,1,0)
EI$cboeTpc<-ifelse(cboeTpc[,1]-lag(cboeTpc[,1])>0,1,0)
EI$cboeEpc<-ifelse(cboeEpc[,1]-lag(cboeEpc[,1])>0,1,0)
EI$cboeVpc<-ifelse(cboeVpc[,1]-lag(cboeVpc[,1])>0,1,0)
**************
getSymbols("^GSPC")
getSymbols("^NDX")
getSymbols("^OEX")
getSymbols("^RUI")
getSymbols("^GSPC")
getSymbols("^IXIC")
getSymbols("^SML")
getSymbols("^RUA")
getSymbols("SPY")
getSymbols("^FTSE")
getSymbols("^FCHI")
getSymbols("^GDAXI")
getSymbols("^HSI")
getSymbols("^N225")
getSymbols("^NSEI")
getSymbols("^VIX")
getSymbols("^VXN")
getSymbols("VXX")
getSymbols("XIV")
getSymbols("UVXY")
getSymbols("^VVIX") 
getSymbols("^OVX")
getSymbols("OIL")
getSymbols("USO")
getSymbols("^GVZ")
getSymbols("GLD")
getSymbols("GDX") 
getSymbols("UGLD")
getSymbols("DGLD")
getSymbols("^TYX")
getSymbols("TLT")#TLT and SST and PRTBX for long term
getSymbols("SST")
getSymbols("PRTBX")
getSymbols("XLE")
getSymbols("XLF")
getSymbols("XLK")
getSymbols("XBI")
getSymbols("XLP")
getSymbols("XLV")
getSymbols("XLU")
getSymbols("XLB")
getSymbols("XLY")
getSymbols("XME")
getSymbols("XLI")
getSymbols("SQQQ")
getSymbols("TQQQ")
getSymbols("FXI")
getSymbols("FWZ")
getSymbols("JPY=X")
getSymbols("EUR=X")
getSymbols("CNY=X")
getSymbols("CAD=X")
getSymbols("GBP=X")
getSymbols("aapl")
getSymbols("msft")
getSymbols("xom")
getSymbols("ge")
getSymbols("jnj")
getSymbols("wfc")
getSymbols("amzn")
getSymbols("BRK")
getSymbols("jpm")
getSymbols("fb")
GSPC$CO<-ifelse((GSPC[,4]-GSPC[,1])>0,1,0)#CLOSE-OPEN>0==chCO
GSPC$GSPC<-ifelse(ROC(GSPC[,4])>0,1,0)
SI<-ROC(GSPC[,4])
SI$CH<-ifelse(GSPC$CO*GSPC$GSPC==1,1,0)
SI$GSPC<-ifelse(ROC(GSPC[,4])>0,1,0)
SI$NDX<-ifelse(ROC(NDX[,4])>0,1,0)
SI$OEX<-ifelse(ROC(OEX[,4])>0,1,0)
SI$FTSE<-ifelse(ROC(FTSE[,4])>0,1,0)
SI$HSI<-ifelse(ROC(HSI[,4])>0,1,0)
SI$VIX<-ifelse(ROC(VIX[,4])>0,1,0)
SI$OIL<-ifelse(ROC(OIL[,4])>0,1,0)
SI$TYX<-ifelse(ROC (TYX[,4])>0,1,0)
SI$TLT<-ifelse(ROC (TLT[,4])>0,1,0)
SI$XLE<-ifelse(ROC(XLE[,4])>0,1,0)
SI$XLF<-ifelse(ROC(XLF[,4])>0,1,0)
SI$XLK<-ifelse(ROC(XLK[,4])>0,1,0)
SI$XLP<-ifelse(ROC(XLP[,4])>0,1,0)
SI$XLV<-ifelse(ROC(XLV[,4])>0,1,0)
SI$XLB<-ifelse(ROC(XLB[,4])>0,1,0)
SI$XLY<-ifelse(ROC(XLY[,4])>0,1,0)
SI$XLI<-ifelse(ROC(XLI[,4])>0,1,0)
SI$AAPL<-ifelse(ROC(AAPL[,4])>0,1,0)
SI$MSFT<-ifelse(ROC(MSFT[,4])>0,1,0)
SI$XOM<-ifelse(ROC(XOM[,4])>0,1,0)
SI$GE<-ifelse(ROC(GE[,4])>0,1,0)
SI$WFC<-ifelse(ROC(JNJ[,4])>0,1,0)
SI$AMZN<-ifelse(ROC(AMZN[,4])>0,1,0)
SI$BRK<-ifelse(ROC(BRK[,4])>0,1,0)
SI$JPM<-ifelse(ROC(JPM[,4])>0,1,0)
SI$FB<-ifelse(ROC(FB[,4])>0,1,0)

for(i in 1:length(SI[,1])){SI$U4D[i]<-ifelse(SI$CH[i+1]==0 && SI$CH[i]==1 && SI$CH[i-1]==1 && SI$CH[i-2]==1 && SI$CH[i-3]==1,1,0)}

for(i in 1:length(SI[,1])){SI$D3U[i]<-ifelse(SI$CH[i+1]==0 && SI$CH[i]==0 && SI$CH[i-1]==0 && SI$CH[i-2]==0,1,0)}

for(i in 1:length(SI[,1])){SI$JD[i]<-ifelse(SI$Ret[i]<(-0.006),1,0)}
for(i in 1:length(SI[,1])){SI$JDd2[i]<-ifelse(SI$JD[i]==1 && SI$CH[i+1]==0 && SI$CH[i+2]==0 && SI$CH[i+3]==1,1,0)}#10%
for(i in 1:length(SI[,1])){SI$JU[i]<-ifelse(SI$Ret[i]>0.0075,1,0)}#
for(i in 1:length(SI[,1])){SI$JUu2[i]<-ifelse(SI$JU[i]==1 && SI$CH[i+1]==1 && SI$CH[i+2]==1 && SI$CH[i+3]==0,1,0)}
SI$Q3<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.90,na.rm=TRUE)#0.75 rolling quantile, 0.90 decile
SI$QH<-ifelse(GSPC[,4]>SI$Q3,1,0)#35% cases
for(i in 1:length(SI[,1])){SI$QJU[i]<-ifelse(SI$Ret[i]>0.003 && SI$QH[i]==1,1,0)}# 19%
for(i in 1:length(SI[,1])){SI$QJUu2[i]<-ifelse(SI$QJU[i]==1 && SI$CH[i+1]==1 && SI$CH[i+2]==1 && && SI$CH[i+3]==0,1,0)}
SI$Q1<-rollapply(as.xts(GSPC[,4]),width=50,FUN="quantile",0.10,na.rm=TRUE)
SI$QL<-ifelse(GSPC[,4]<SI$Q1,1,0)
for(i in 1:length(SI[,1])){SI$QJD[i]<-ifelse(SI$Ret[i]<(-0.002) && SI$QL[i]==1,1,0)}#6% 
for(i in 1:length(SI[,1])){SI$QJDd2[i]<-ifelse(SI$QJD[i]==1 && SI$CH[i+1]==0 && SI$CH[i+2]==0 && && SI$CH[i+3]==1,1,0)}
****
EI<-na.omit(EI)
SI<-na.omit(SI)
