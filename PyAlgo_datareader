#pandas-datareader
#https://github.com/pydata/pandas-datareader
#pip install pandas-datareader
#import pandas.io.data as web # not in use
#Necessary Imports
import numpy as np  # array operations
import pandas as pd  # time series management
import pandas_datareader.data as web
#from pandas_datareader import data as web  # data retrieval
# source activate PyAlgo
#python /home/octo/Desktop/QTPY/qt.py
#pip install seaborn
import seaborn as sns
sns.set()  # nicer plotting style
import datetime
# put all plots in the notebook itself
#%matplotlib inline
import matplotlib.pyplot as plt
#Retrieving Stock Price Data
def import_yahoo(symbol):
    #df=pd.read_csv("***.csv")
    start = datetime.datetime(2010, 1, 1)
    end = datetime.datetime(2015, 5, 9)
    STa=web.DataReader(format(symbol), 'yahoo-actions', start, end)
    #TQQQp= web.DataReader('TQQQ', data_source='yahoo')#full data set
    STp = web.DataReader(format(symbol), 'yahoo', start, end)
    #TQQQd = web.DataReader('TQQQ', 'yahoo-dividends', start, end)
    #return STa[5:7]#rows between 5 and 6 sp only 1 not 2
    #return STa.tail()
    #return STp['Adj Close'].tail()
    #return STa.tail(),STp['Close'].max(),STp['Volume'].mean(),# set return at end after plot then plot will be visible and cross out max value visisble
    #http://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html
    #http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.head.html
    #http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.tail.html
    #print STp.ix['2014-01-04']
    #%time
    STp['Return'] = np.log(STp['Close']/STp['Close'].shift(1))
    STp[['Close','Return']].tail()
    #del STp['Open']# one return column is to delete
    STp[['Close','High','Return']].plot(subplots=True,style='b',figsize=(8,5))
#http://matplotlib.org/users/pyplot_tutorial.html#working-with-text
    #TQQQp['Adj Close'].plot()
    #TQQQp['Return'].plot(figsize=(8,5))
    plt.show()
    return STa.tail(),STp['Close'].max(),STp['Volume'].mean(),# set return at end after plot then plot will be visible and cross out max value visisble

def data_analysis():
    for symbol in ['TQQQ','SQQQ','UWTI','DWTI','UPRO','SPXU','SPXS']:
        print "max value and mean value"
        print symbol,import_yahoo(symbol)

if __name__ == '__main__':
    #main()
    #import_yahoo()
    data_analysis()

****NOT A GOOD FUNCTION
def data_frame():
    #df=pd.read_csv("***.csv")
    #dfSPY=pd.read_csv(",csv",index_col="Date",parse_dates=True,usecols=['Date','Adj Close'],na_values=['nan'])
    start = datetime.datetime(2010, 1, 1)
    end = datetime.datetime(2016,5,7)
    TQQQp= web.DataReader('TQQQ', 'yahoo', start, end)
    SQQQp= web.DataReader('SQQQ', 'yahoo', start, end)
    UWTIp= web.DataReader('UWTI', 'yahoo', start, end)
    DWTIp= web.DataReader('DWTI', 'yahoo', start, end)
    UPROp= web.DataReader('UPRO', 'yahoo', start, end)
    SPXUp= web.DataReader('SPXU', 'yahoo', start, end)
    SPXSp= web.DataReader('SPXS','yahoo', start, end)
#    STp['Return'] = np.log(STp['Close']/STp['Close'].shift(1))
#    STp[['Close','Return']].tail()
    start_day='2010-01-01'
    end_day='2016-05-07'
    dates=pd.date_range(start_day,end_day)
    df1=pd.DataFrame(index=dates)
    df1=df1.join(TQQQp['Close'])
    df1=df1.join(SQQQp['Close'])
    df1=df1.join(UWTIp['Close'])
#http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.join.html
    return df1.dropna()
***NOT WORKING 
def data_analysis():
    start = datetime.datetime(2010, 1, 1)
    end = datetime.datetime(2016,5,7)
    start_day='2010-01-01'
    end_day='2016-05-07'
    dates=pd.date_range(start_day,end_day)
    df1=pd.DataFrame(index=dates)
    for symbol in ['TQQQ','SQQQ','UWTI','DWTI','UPRO','SPXU','SPXS']:
        #print "max value and mean value"
        #print symbol,import_yahoo(symbol)
        STp = web.DataReader(format(symbol), 'yahoo', start, end)
        df_temp=STp['Close'].rename(columns={'Close':symbol})
        df1=df1.join(df_temp)
        #http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.join.html
    print df1.dropna()
    
